{"repository_name":"github.com/cocol-project/ccl-pow","body":"# Cocol Proof of Work\n![weekly](https://github.com/cocol-project/ccl-pow/workflows/weekly/badge.svg)\n---\n\nBitcoin style Proof of Work lib written in Crystal\n\nDocs: https://cocol-project.github.io/ccl-pow\n\n## Installation\n\n1. Add the dependency to your `shard.yml`:\n\n```yaml\ndependencies:\n  btcpow:\n    github: cocol-project/ccl-pow\n```\n\n2. Run `shards install`\n\n## Usage\n\n```crystal\nrequire \"ccl-pow\"\n```\n\n#### Mining\n```crystal\nCCL::Pow.mine(difficulty: \"1d00ffff\", for: \"my_block_data\")\n```\n\n#### Calculate target based on difficulty bits\n```crystal\nCCL::Pow::Utils.calculate_target(from: \"1d00ffff\")\n```\n\n## Contributing\n\n1. Fork it (<https://github.com/cocol-project/ccl-pow/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [Cristian È˜erb](https://github.com/cserb) - creator and maintainer\n","program":{"html_id":"github.com/cocol-project/ccl-pow/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"github.com/cocol-project/ccl-pow","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/cocol-project/ccl-pow/CCL","path":"CCL.html","kind":"module","full_name":"CCL","name":"CCL","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"ccl-pow.cr","line_number":7,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow","path":"CCL/Pow.html","kind":"module","full_name":"CCL::Pow","name":"Pow","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"ccl-pow.cr","line_number":7,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow","kind":"module","full_name":"CCL::Pow","name":"Pow"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/cocol-project/ccl-pow/CCL","kind":"module","full_name":"CCL","name":"CCL"},"doc":"A Bitcoin style Proof of Work library for Crystal\nMostly inspired by @aantonop's proof of work example\nhttps://github.com/bitcoinbook/bitcoinbook/blob/develop/code/proof-of-work-example.py","summary":"<p>A Bitcoin style Proof of Work library for Crystal Mostly inspired by @aantonop's proof of work example https://github.com/bitcoinbook/bitcoinbook/blob/develop/code/proof-of-work-example.py</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"mine(difficultynbits:String,forinput_data:InputData):Work-instance-method","html_id":"mine(difficultynbits:String,forinput_data:InputData):Work-instance-method","name":"mine","doc":"Returns the nonce and the hash found for the given data input and difficulty\n\n```\nCCL::Pow.mine(difficulty: \"1d00ffff\", for: \"my_blockchain_data\")\n```","summary":"<p>Returns the nonce and the hash found for the given data input and difficulty</p>","abstract":false,"args":[{"name":"nbits","doc":null,"default_value":"","external_name":"difficulty","restriction":"String"},{"name":"input_data","doc":null,"default_value":"","external_name":"for","restriction":"InputData"}],"args_string":"(difficulty nbits : String, for input_data : InputData) : Work","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L22","def":{"name":"mine","args":[{"name":"nbits","doc":null,"default_value":"","external_name":"difficulty","restriction":"String"},{"name":"input_data","doc":null,"default_value":"","external_name":"for","restriction":"InputData"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Work","visibility":"Public","body":"target = Utils.calculate_target(from: nbits)\n(0_u64..UInt64::MAX).each do |nonce|\n  hash = Utils.calculate_hash(nonce, data: input_data)\n  if (BigInt.new(hash, 16)) < target\n    return Work.new(nonce: nonce, hash: hash)\n  end\nend\nraise(\"Canary dead\")\n"}}],"macros":[],"types":[{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/BlockHash","path":"CCL/Pow/BlockHash.html","kind":"alias","full_name":"CCL::Pow::BlockHash","name":"BlockHash","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"ccl-pow.cr","line_number":11,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":true,"aliased":"String","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow","kind":"module","full_name":"CCL::Pow","name":"Pow"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/InputData","path":"CCL/Pow/InputData.html","kind":"alias","full_name":"CCL::Pow::InputData","name":"InputData","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"ccl-pow.cr","line_number":10,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":true,"aliased":"String","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow","kind":"module","full_name":"CCL::Pow","name":"Pow"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/Utils","path":"CCL/Pow/Utils.html","kind":"module","full_name":"CCL::Pow::Utils","name":"Utils","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"ccl-pow.cr","line_number":35,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"id":"MIN_NBITS","name":"MIN_NBITS","value":"\"20100000\"","doc":null,"summary":null},{"id":"MIN_TARGET","name":"MIN_TARGET","value":"BigInt.new(\"1000000000000000000000000000000000000000000000000000000000000000\", 16)","doc":null,"summary":null}],"included_modules":[],"extended_modules":[{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/Utils","kind":"module","full_name":"CCL::Pow::Utils","name":"Utils"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow","kind":"module","full_name":"CCL::Pow","name":"Pow"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"calculate_hash(nonce:UInt64,data:String):BlockHash-instance-method","html_id":"calculate_hash(nonce:UInt64,data:String):BlockHash-instance-method","name":"calculate_hash","doc":"Returns the hash for `nonce` + `data`\n\n```\nCCL::Pow::Utils.calculate_hash(nonce: 20151213_u64, data: \"cocol\") # => \"5906039dfa0262343155216f0d73135d30fd48a0d4543c61d27169db12736d3a\"\n```","summary":"<p>Returns the hash for <code>nonce</code> + <code>data</code></p>","abstract":false,"args":[{"name":"nonce","doc":null,"default_value":"","external_name":"nonce","restriction":"UInt64"},{"name":"data","doc":null,"default_value":"","external_name":"data","restriction":"String"}],"args_string":"(nonce : UInt64, data : String) : BlockHash","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L48","def":{"name":"calculate_hash","args":[{"name":"nonce","doc":null,"default_value":"","external_name":"nonce","restriction":"UInt64"},{"name":"data","doc":null,"default_value":"","external_name":"data","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"BlockHash","visibility":"Public","body":"sha = OpenSSL::Digest.new(\"SHA256\")\nsha.update(\"#{nonce}#{data}\")\nsha.hexdigest\n"}},{"id":"calculate_nbits(fromtarget:BigInt):NBits-instance-method","html_id":"calculate_nbits(fromtarget:BigInt):NBits-instance-method","name":"calculate_nbits","doc":"Returns the target as nbits from a given numerical target\n\n```\nCCL::Pow::Utils.calculate_nbits(from: BigInt.new(\"26959535291011309493156476344723991336010898738574164086137773096960\")) # => \"1d00ffff\"\n```","summary":"<p>Returns the target as nbits from a given numerical target</p>","abstract":false,"args":[{"name":"target","doc":null,"default_value":"","external_name":"from","restriction":"BigInt"}],"args_string":"(from target : BigInt) : NBits","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L74","def":{"name":"calculate_nbits","args":[{"name":"target","doc":null,"default_value":"","external_name":"from","restriction":"BigInt"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"NBits","visibility":"Public","body":"h_target = target.to_s(16)\nfirst_digit = h_target[0..1].to_i(16)\nif first_digit > 127\n  h_target = \"00#{h_target}\"\nend\nsize = (h_target.bytesize / 2).to_i32\n\"#{size.to_s(16)}#{h_target[0..5]}\"\n"}},{"id":"calculate_target(fromnbits:String):BigInt-instance-method","html_id":"calculate_target(fromnbits:String):BigInt-instance-method","name":"calculate_target","doc":"Returns the numerical target threshold based on the given difficulty\n\nFind out more about it here\nhttps://github.com/bitcoinbook/bitcoinbook/blob/develop/ch10.asciidoc#target-representation\n\n```\nCCL::Pow::Utils.calculate_target(from: \"1d00ffff\") # => 26959535291011309493156476344723991336010898738574164086137773096960\n```","summary":"<p>Returns the numerical target threshold based on the given difficulty</p>","abstract":false,"args":[{"name":"nbits","doc":null,"default_value":"","external_name":"from","restriction":"String"}],"args_string":"(from nbits : String) : BigInt","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L62","def":{"name":"calculate_target","args":[{"name":"nbits","doc":null,"default_value":"","external_name":"from","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"BigInt","visibility":"Public","body":"exponent = BigInt.new(nbits[0..1], 16)\ncoefficient = BigInt.new(nbits[2..7], 16)\ncoefficient * ((BigInt.new(2)) ** ((BigInt.new(8)) * (exponent - (BigInt.new(3)))))\n"}},{"id":"retarget(start_time:Float64,end_time:Float64,wanted_timespan:Float64,current_target:BigInt,min_target=MIN_TARGET):NBits-instance-method","html_id":"retarget(start_time:Float64,end_time:Float64,wanted_timespan:Float64,current_target:BigInt,min_target=MIN_TARGET):NBits-instance-method","name":"retarget","doc":"Returns the retargeted difficulty based on the timestamp of a given block\nand the timespan in minutes.\n\nAssuming you want retarget for the last minute in which you targeted 12 blocks\nyou would pass the timestamp of the `current_block - 12` and 60 seconds as wanted_timepan\n\n```\nCCL::Pow::Utils.retarget(\n  start_time: 1559306286_f64,\n  end_time: 1559306286_f64,\n  wanted_timespan: 60_f64,\n  current_target: CCL::Pow::Utils.calculate_target(\"1e38ae39\")\n) # => \"1e00b560\"\n```","summary":"<p>Returns the retargeted difficulty based on the timestamp of a given block and the timespan in minutes.</p>","abstract":false,"args":[{"name":"start_time","doc":null,"default_value":"","external_name":"start_time","restriction":"Float64"},{"name":"end_time","doc":null,"default_value":"","external_name":"end_time","restriction":"Float64"},{"name":"wanted_timespan","doc":null,"default_value":"","external_name":"wanted_timespan","restriction":"Float64"},{"name":"current_target","doc":null,"default_value":"","external_name":"current_target","restriction":"BigInt"},{"name":"min_target","doc":null,"default_value":"MIN_TARGET","external_name":"min_target","restriction":""}],"args_string":"(start_time : Float64, end_time : Float64, wanted_timespan : Float64, current_target : BigInt, min_target = <span class=\"t\">MIN_TARGET</span>) : NBits","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L98","def":{"name":"retarget","args":[{"name":"start_time","doc":null,"default_value":"","external_name":"start_time","restriction":"Float64"},{"name":"end_time","doc":null,"default_value":"","external_name":"end_time","restriction":"Float64"},{"name":"wanted_timespan","doc":null,"default_value":"","external_name":"wanted_timespan","restriction":"Float64"},{"name":"current_target","doc":null,"default_value":"","external_name":"current_target","restriction":"BigInt"},{"name":"min_target","doc":null,"default_value":"MIN_TARGET","external_name":"min_target","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"NBits","visibility":"Public","body":"if start_time >= end_time\n  return calculate_nbits(min_target)\nend\npassed_time = end_time - start_time\nnew_num_target = current_target * (BigFloat.new(passed_time / wanted_timespan))\nif new_num_target > min_target\n  return calculate_nbits(min_target)\nend\ncalculate_nbits(from: BigInt.new(new_num_target))\n"}}],"macros":[],"types":[{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/Utils/NBits","path":"CCL/Pow/Utils/NBits.html","kind":"alias","full_name":"CCL::Pow::Utils::NBits","name":"NBits","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"ccl-pow.cr","line_number":41,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":true,"aliased":"String","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/Utils","kind":"module","full_name":"CCL::Pow::Utils","name":"Utils"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow/Work","path":"CCL/Pow/Work.html","kind":"struct","full_name":"CCL::Pow::Work","name":"Work","abstract":false,"superclass":{"html_id":"github.com/cocol-project/ccl-pow/Struct","kind":"struct","full_name":"Struct","name":"Struct"},"ancestors":[{"html_id":"github.com/cocol-project/ccl-pow/Struct","kind":"struct","full_name":"Struct","name":"Struct"},{"html_id":"github.com/cocol-project/ccl-pow/Value","kind":"struct","full_name":"Value","name":"Value"},{"html_id":"github.com/cocol-project/ccl-pow/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"ccl-pow.cr","line_number":13,"url":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr"}],"repository_name":"github.com/cocol-project/ccl-pow","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/cocol-project/ccl-pow/CCL/Pow","kind":"module","full_name":"CCL::Pow","name":"Pow"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(nonce:UInt64,hash:BlockHash)-class-method","html_id":"new(nonce:UInt64,hash:BlockHash)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"nonce","doc":null,"default_value":"","external_name":"nonce","restriction":"UInt64"},{"name":"hash","doc":null,"default_value":"","external_name":"hash","restriction":"BlockHash"}],"args_string":"(nonce : UInt64, hash : BlockHash)","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L13","def":{"name":"new","args":[{"name":"nonce","doc":null,"default_value":"","external_name":"nonce","restriction":"UInt64"},{"name":"hash","doc":null,"default_value":"","external_name":"hash","restriction":"BlockHash"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(nonce, hash)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"clone-instance-method","html_id":"clone-instance-method","name":"clone","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L13","def":{"name":"clone","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self.class.new(@nonce.clone, @hash.clone)"}},{"id":"copy_with(nonce_nonce=@nonce,hash_hash=@hash)-instance-method","html_id":"copy_with(nonce_nonce=@nonce,hash_hash=@hash)-instance-method","name":"copy_with","doc":null,"summary":null,"abstract":false,"args":[{"name":"_nonce","doc":null,"default_value":"@nonce","external_name":"nonce","restriction":""},{"name":"_hash","doc":null,"default_value":"@hash","external_name":"hash","restriction":""}],"args_string":"(nonce _nonce = @nonce, hash _hash = @hash)","source_link":"https://github.com/cocol-project/ccl-pow/blob/d0a2b7a4f7eb4b4b08cdc6db39ce816689e72320/src/ccl-pow.cr#L13","def":{"name":"copy_with","args":[{"name":"_nonce","doc":null,"default_value":"@nonce","external_name":"nonce","restriction":""},{"name":"_hash","doc":null,"default_value":"@hash","external_name":"hash","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"self.class.new(_nonce, _hash)"}},{"id":"hash:BlockHash-instance-method","html_id":"hash:BlockHash-instance-method","name":"hash","doc":"Generates an `UInt64` hash value for this object.\n\nThis method must have the property that `a == b` implies `a.hash == b.hash`.\n\nThe hash value is used along with `==` by the `Hash` class to determine if two objects\nreference the same hash key.\n\nSubclasses must not override this method. Instead, they must define `hash(hasher)`,\nthough usually the macro `def_hash` can be used to generate this method.","summary":"<p>Generates an <code>UInt64</code> hash value for this object.</p>","abstract":false,"args":[],"args_string":" : BlockHash","source_link":null,"def":{"name":"hash","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"BlockHash","visibility":"Public","body":"@hash"}},{"id":"nonce:UInt64-instance-method","html_id":"nonce:UInt64-instance-method","name":"nonce","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : UInt64","source_link":null,"def":{"name":"nonce","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"UInt64","visibility":"Public","body":"@nonce"}}],"macros":[],"types":[]}]}]}]}}